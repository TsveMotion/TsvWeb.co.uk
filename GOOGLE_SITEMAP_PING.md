# Google & Search Engine Integration

## Important Update (June 2023)

**Google deprecated the sitemap ping endpoint.** Google now automatically crawls sitemaps regularly based on the `lastmod` element.

## Overview

Your TsvWeb application automatically notifies search engines when blog content changes:
- ‚úÖ **IndexNow** (Bing, Yandex, Naver, Seznam) - Active notifications
- ‚úÖ **Google** - Automatic sitemap crawling (no ping needed)

## How It Works

### Automatic Notifications

When you create, update, or delete a published blog post:

1. **IndexNow** (Bing, Yandex, Naver, Seznam)
   - Submits the specific URL to IndexNow API
   - Response: HTTP 200 (success)
   - Instant notification

2. **Google** (Automatic)
   - Your sitemap includes `lastmod` timestamps
   - Google crawls your sitemap regularly
   - Google detects changes via `lastmod` updates
   - No manual ping needed

### Why This Approach?

Google doesn't support IndexNow protocol. Google's recommendations (as of June 2023):
- ‚úÖ Submit sitemaps to Google Search Console (you have this)
- ‚úÖ Use `lastmod` element in sitemaps (next-sitemap does this automatically)
- ‚úÖ Use structured data for rich results
- ‚ùå ~~Sitemap ping~~ (deprecated in June 2023)

**Your sitemap** (`https://tsvweb.com/sitemap.xml`) is automatically updated by `next-sitemap` during build with `lastmod` timestamps, which Google uses to detect changes.

## Console Logs

When a blog post is created/updated/deleted, you'll see:

```
üì§ Submitting 1 URL(s) to IndexNow...
‚úÖ Successfully submitted to 1 search engine(s)
```

**Note:** Google is notified automatically through sitemap crawling - no ping needed!

## Manual Usage

### Submit to IndexNow Manually

```bash
# PowerShell
Invoke-WebRequest -Uri "http://localhost:3000/api/indexnow" `
  -Method POST `
  -Headers @{"Content-Type"="application/json"} `
  -Body '{"url": "https://tsvweb.com/blog/my-post"}'
```

### Code Usage

```typescript
import { indexNowService } from '@/services/indexnow-service';

// Submit to IndexNow (Bing, Yandex, etc.)
await indexNowService.submitBlogPost('my-post-slug');

// Submit any URL
await indexNowService.submitUrl('/blog/my-post');
```

## API Endpoints

### POST /api/indexnow

**Submit single URL:**
```json
{
  "url": "https://tsvweb.com/blog/my-post"
}
```

**Submit multiple URLs:**
```json
{
  "urls": [
    "https://tsvweb.com/blog/post-1",
    "https://tsvweb.com/blog/post-2"
  ]
}
```

## Search Engine Coverage

### ‚úÖ Automatic Notifications

| Search Engine | Method | Status |
|---------------|--------|--------|
| **Bing** | IndexNow | ‚úÖ Active |
| **Yandex** | IndexNow | ‚úÖ Active |
| **Google** | Sitemap + lastmod | ‚úÖ Automatic |
| **Naver** | IndexNow | ‚úÖ Active |
| **Seznam.cz** | IndexNow | ‚úÖ Active |

### üìä Additional Setup (Already Done)

| Feature | Status | Notes |
|---------|--------|-------|
| Sitemap | ‚úÖ Active | `next-sitemap` generates on build |
| Google Search Console | ‚úÖ Verified | `NEXT_PUBLIC_GOOGLE_SITE_VERIFICATION` |
| Robots.txt | ‚úÖ Active | Generated by `next-sitemap` |
| Structured Data | ‚ö†Ô∏è Manual | Add to blog posts for rich results |

## Benefits

### Before
- ‚è∞ Wait for Google crawler (days/weeks)
- üêå Manual sitemap submission
- ‚ùì Uncertain discovery time

### After
- ‚ö° **Instant notification** to Google
- üöÄ **Automatic** sitemap ping on content changes
- ‚úÖ **Dual coverage** (IndexNow + Google)
- üìä **Faster indexing** across all major search engines

## Monitoring

### Check Logs

Look for these messages in your server console:

**IndexNow Success:**
```
üì§ Submitting 1 URL(s) to IndexNow...
‚úÖ Successfully submitted to 1 search engine(s)
```

**IndexNow Error (non-breaking):**
```
‚ùå IndexNow submission failed: [error details]
```

### Google Search Console

Monitor your indexing status:
1. Go to [Google Search Console](https://search.google.com/search-console)
2. Check **Sitemaps** section
3. View **Coverage** report
4. Monitor **Performance** metrics

## Troubleshooting

### Sitemap Not Found

**Problem:** Google can't access sitemap

**Solution:**
1. Verify sitemap exists: `https://tsvweb.com/sitemap.xml`
2. Check it was generated: `npm run build`
3. Ensure `next-sitemap` ran during build
4. Verify no robots.txt blocking

### No Indexing Improvement

**Problem:** Content still not indexed quickly

**Possible Reasons:**
- New sites take time to build trust
- Content quality matters
- Google evaluates before indexing
- Sitemap ping doesn't guarantee indexing

**What to Do:**
- Wait 24-48 hours for processing
- Check Google Search Console for issues
- Ensure content is high quality and unique
- Add structured data to blog posts
- Build backlinks to improve authority

## Best Practices

### ‚úÖ DO:
- Let automatic IndexNow notifications handle Bing/Yandex
- Monitor Google Search Console regularly
- Keep sitemap updated (automatic with next-sitemap)
- Add structured data to blog posts
- Submit sitemap to Google Search Console once
- Trust Google's automatic sitemap crawling

### ‚ùå DON'T:
- Try to ping Google (deprecated since June 2023)
- Expect instant Google indexing (they evaluate quality)
- Worry about manual Google notifications
- Rely solely on notifications (content quality matters)

## Advanced: Structured Data

To further improve Google indexing, add structured data to your blog posts:

```typescript
// In your blog post page component
const structuredData = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": post.title,
  "image": post.featuredImage,
  "datePublished": post.publishedAt,
  "dateModified": post.updatedAt,
  "author": {
    "@type": "Person",
    "name": post.author
  },
  "publisher": {
    "@type": "Organization",
    "name": "TsvWeb",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tsvweb.com/logo.png"
    }
  }
};

// Add to page
<script
  type="application/ld+json"
  dangerouslySetInnerHTML={{ __html: JSON.stringify(structuredData) }}
/>
```

## Resources

- **Google Sitemap Ping:** https://developers.google.com/search/docs/crawling-indexing/sitemaps/build-sitemap#addsitemap
- **Google Search Console:** https://search.google.com/search-console
- **IndexNow Documentation:** https://www.indexnow.org/documentation
- **Structured Data Testing:** https://search.google.com/test/rich-results

---

**Status:** ‚úÖ Active  
**Coverage:** Google, Bing, Yandex, and more  
**Automation:** Fully automatic on blog changes
